name: Fetch MOEX H1 Data (35 rows)

on:
  schedule:
    # Запускать ежедневно в 00:01 UTC
    - cron: '2 8 * * *'
  workflow_dispatch:

# Добавьте этот блок для предоставления прав на запись
permissions:
  contents: write

jobs:
  fetch-data: # Имя job'ы
    runs-on: ubuntu-latest # Правильный отступ (2 пробела)

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        # Явно передаем токен с правами на запись
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    # Устанавливаем зависимости напрямую, без requirements.txt
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        python -m pip install requests pandas

    - name: Run fetch script
      run: python fetch_moex_H1_35.py
      
    - name: Commit and push if changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add -A
        if git diff --staged --quiet; then
          echo "Нет изменений для коммита."
        else
          git commit -m "Update MOEX H1 data (35 rows) [skip ci]" -a
          git push
        fi
